[ports]
solr = 8983

[hosts]
solr = 127.0.0.1

[settings]
solr = http://${hosts:solr}:${ports:solr}/solr/

[solr-ini]
recipe = collective.recipe.template[genshi]:genshi
input = ${buildout:directory}/templates/data-config.xml.in
output = ${buildout:directory}/etc/data-config.xml

[solr-download]
recipe = hexagonit.recipe.download
strip-top-level-dir = true
url = http://archive.apache.org/dist/lucene/solr/4.9.0/solr-4.9.0.zip

[solr]
recipe = collective.recipe.solrinstance
solr-location = ${solr-download:location}
host = ${hosts:solr}
port = ${ports:solr}
section-name = SOLR
unique-key = uniqueID
index = name:uniqueID type:string indexed:true stored:true required:true
abortOnConfigurationError = true
additional-solrconfig = 
    <lib dir="${buildout:directory}/parts/solr/dist/" regex="solr-dataimporthandler-\d.*\.jar" />
    <lib dir="${buildout:directory}/parts/solr/dist/" regex="postgresql-\d.*\.jar" />
    <requestHandler name="/dataimport" class="org.apache.solr.handler.dataimport.DataImportHandler">
        <lst name="defaults">
            <str name="config">${buildout:directory}/parts/solr/solr/collection1/conf/data-config.xml</str>
        </lst>
    </requestHandler>

[solr-update]
recipe = collective.recipe.cmd
on_update = true
on_install = true
cmds =
    cp ${buildout:directory}/solr-dist/postgresql-9.3-1101.jdbc41.jar ${buildout:directory}/parts/solr/dist
    cp ${buildout:directory}/templates/schema.xml ${buildout:directory}/parts/solr/solr/collection1/conf
    cp ${buildout:directory}/etc/data-config.xml ${buildout:directory}/parts/solr/solr/collection1/conf
